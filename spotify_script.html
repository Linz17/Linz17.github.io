<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Marie Le Bars" />
<link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
<title>Spotify Playlist Explorer (script) - @mlebars</title>
</head>

<body>
    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
            <div id="forkme_banner">
          <a href="http://mlebars.github.io">Home</a>
          <a href="http://mlebars.github.io/spotify.html">Report</a>
</div>
          <h1 id="project_title">Spotify Playlist Explorer: Full Script</h1>
          <h2 id="project_tagline"></h2>

        </header>
    </div>
        <!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

<div id="script" class="section level3">
<h3>Script</h3>
<pre class="r"><code>
# spotifyKey <- your_key
# spotifySecret <- your_secret
# spotifyUser <- your_username
# spotifyPlaylist <- your_playlist

library("httr")
library("jsonlite")

spotifyEndpoint <- oauth_endpoint(NULL, 
                                 "https://accounts.spotify.com/authorize", 
                                 "https://accounts.spotify.com/api/token")
spotifyApp <- oauth_app("spotify", spotifyKey, spotifySecret)
spotifyToken <- oauth2.0_token(spotifyEndpoint, spotifyApp)

playlistTracksURL <- paste("https://api.spotify.com/v1/users/",
                           spotifyUser,
                           "/playlists/",
                           spotifyPlaylist,
                           "/tracks?fields=total,items(track(album(id)))"
                           ,sep="")

getTracks <- GET(playlistTracksURL, spotifyToken)

startPlaylist <- jsonlite::fromJSON(toJSON(content(getTracks)))
total <- as.matrix(startPlaylist[[1]]$track$album$id)

if (startPlaylist$total > 100) {
  offset <- trunc(startPlaylist$total/100)
  for(i in 1:offset) {
    playlistTracksURL <- paste("https://api.spotify.com/v1/users/"
                               ,spotifyUser,
                               "/playlists/",
                               spotifyPlaylist,
                               "/tracks?fields=items(track(album(id)))&offset=",
                               i*100,sep="")
    getTracks <- GET(playlistTracksURL, spotifyToken)
    subPlaylist <- jsonlite::fromJSON(toJSON(content(getTracks)))
    total <- rbind(total, as.matrix(subPlaylist[[1]]$track$album$id))
  }
}

total <- as.data.frame(total)

for(i in 1:length(total[,1])) {
  albumURL <- paste("https://api.spotify.com/v1/albums/", total[i,1], sep="")
  getAlbum <- GET(albumURL, spotifyToken)
  album <- jsonlite::fromJSON(toJSON(content(getAlbum)))
  total[i,2] <- as.numeric(substr(album$release_date,1,4))
}

hist(total[,2], breaks = (max(total[,2])-min(total[,2])), 
     col="lightblue", main = "Songs by year", xlab = "", ylab="")
</code></pre>
</div>
</section>
    </div>
    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
